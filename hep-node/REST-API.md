# HEP Node API

## Basic Parameters
### Request
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| dapp_key | string | The decentralized application access key |
| protocol | string    | The protocol name. default is "HEP".                |
| version | string    | The protocol version such as "1.0"                |
| ts        | number    | The current timestamp                                  |
| nonce            | string | The random string or auto-increment sequence                              |
| os | string | The operating system of client such as ios, android, dweb,etc. |
| language | string | The i18n language code such as zh, en, etc. |
| dapp_signature_method            | string | The signature method used by dapp. |
| dapp_signature            | string | The signature generated by dapp. |

The timestamp and nonce fields is for preventing the replay attack.

#### dapp_signature_method
* `HMAC-MD5` - MD5
* `HMAC-SHA2` - SHA2
* `HMAC-SHA3` - Keccak-256

#### Signature Base String
The Signature Base String is a consistent reproducible concatenation of the request elements into a single string. The string is used as an input in hashing or signing algorithms. The HMAC-SHA256 signature method provides both a standard and an example of using the Signature Base String with a signing algorithm to generate signatures. 

* Normalize Request Parameters
The request parameters are collected, sorted and concatenated into a normalized string:

Parameters in the HTTP POST request body (with a content-type of application/x-www-form-urlencoded).
HTTP GET parameters added to the URLs in the query part (as defined by [RFC3986]).
The 'dapp_signature_method', 'dapp_signature', 'signature', 'sign_type' parameter MUST be excluded.

The parameters are normalized into a single string as follows:

Parameters are sorted by name, using lexicographical byte value ordering. If two or more parameters share the same name, they are sorted by their value. For example:
                    `a=1, c=hi%20there, f=25, f=50, f=a, z=p, z=t`
Parameters are concatenated in their sorted order into a single string. For each parameter, the name is separated from the corresponding value by an '=' character (ASCII code 61), even if the value is empty. Each name-value pair is separated by an '&' character (ASCII code 38). For example:
                    `a=1&c=hi%20there&f=25&f=50&f=a&z=p&z=t`


`
If value is a list or dictionary, the generated string will be the ordered json string. 
`

* Concatenate Request Elements
The following items MUST be concatenated in order into a single string. Each item is encoded and separated by an '&' character (ASCII code 38), even if empty.

The HTTP request method used to send the request. Value MUST be uppercase, for example: HEAD, GET , POST, etc.



### Response
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| message       | string    | error message         |
| errors       | json    | error list, see [error.json](schema/error.json) |

### Note
sign_type: secp256r1 
https://tools.ietf.org/search/rfc4492#appendix-A
## NewNet

*** 

### newnet_cacheAuth
Cache the authentication request.

#### Path
`
/newnet/caches/auth/
`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| dapp_id           | string | The decentralized application ID                             |
| uuid           | string | The request uuid                             |
| action           | string | The action name which value is "hep.auth.login".                             |
| scope            | int    | The request profile type. 1: base profile including name,head,newid; 2: advance profile including cellphone.  |
| expired          | number | The expired timestamp                             |
| memo             | string | The login Memo,optional.                             |
| sign_type             | string | The signature Type,aka cryptographic algorithm. |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |


#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| auth_hash           | string | The hash of auth information                             |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "hash": "...."
}
```
   
*** 

### newnet_getAuthCache
Get the authentication information by given request hash.

#### Path
`
/newnet/caches/auth/:auth_hash/
`

#### Parameters
none

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| uuid           | string | The request uuid                             |
| dapp_id           | string | The decentralized application ID                             |
| protocol | string    | The protocol name. default is "HEP".                |
| version | string    | The protocol version. example is "1.0".                |
| ts        | number    | The current timestamp                                  |
| nonce            | string | The random string or auto-increment sequence                              |
| sign_type        | string | Signature Type,aka cryptographic algorithm |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |
| action           | string | The action name which value is "hep.auth.login"                             |
| scope            | int    | The profile type. 1: base profile including name,head,newid; 2: advance profile including cellphone  |
| expired          | number | The expired timestamp                             |
| memo             | string | The login Memo,optional                             |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "uuid": "...",
    "signature": "...",
    "dapp_id": "...",
    "protocol": "....",
    "version": "1.0",
    "ts": 1559122027,
    "nonce": "...",
    "action": "...",
    "scope": 1,
    "expired": 1559122027,
    "memo": "...."
}
```

### newnet_newPayCache
#### Path
`
/newnet/caches/pay/
`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| uuid             | string | The request uuid                             |
| dapp_id           | string | The decentralized application ID                             |
| action           | string | The action name which value is "hep.pay.order"                             |
| expired          | number | The expired timestamp                             |
| description      | string | The order description |
| price_currency   | string | The symbol of fiat or digital token, such as USD, CNY, NEW,BTC,ETH.
| total_price      | string | The amount of fiat or digital token, unit is the minimum unit of given fiat or digital token. |
| order_number     | string | The order number |
| seller           | string | The seller's NewID  |
| customer         | string | The customer's NewID |
| broker           | string | The broker's NewID. optional.  |
| sign_type        | string | Signature Type,aka cryptographic algorithm |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| pay_hash           | string | The payment request hash                             |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "pay_hash": "...."
}
```
   
*** 

### newnet_getPayCache
Get the payment information by given request hash.

#### Path
`
/newnet/caches/pay/:pay_hash/
`

#### Parameters
none

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| uuid           | string | request uuid                             |
| dapp_id           | string | The decentralized application ID                             |
| protocol | string    | protocol name. The default is "HEP".                |
| version | string    | protocol version. The example is "1.0".                |
| ts        | number    | timestamp                                  |
| nonce            | string | random string or auto-increment sequence                              |
| sign_type        | string | Signature Type,aka cryptographic algorithm |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |
| action           | string | The value is "hep.pay.order". |
| expired          | number | Expired timestamp                             |
| description      | string | The order description |
| price_currency   | string | symbol of fiat or digital token, such as USD, CNY, NEW,BTC,ETH
| total_price      | string | amount of fiat or digital token, unit is the minimum unit of given fiat or digital token |
| order_number     | string | The order number. |
| seller           | string | The seller's NewID  |
| customer         | string | The customer's NewID |
| broker           | string | The broker's NewID.  |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "uuid": "...",
    "dapp_id": "...",
    "protocol": "....",
    "version": "1.0",
    "ts": 1559122027,
    "nonce": "...",
    "signature": "...",
    "action": "...",
    "expired": 1559122027,
    ...
}
```

## Proof

### proof_submitProof

In this case, we should check the delegate balance of dapp.

#### Path
`
/proofs/
`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| dapp_id           | string | The decentralized application ID                             |
| content      | json | The content of proof. |
| sign_type        | string | Signature Type,aka cryptographic algorithm |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |
| uuid | string | uuid |
| action           | string | The value is "hep.proof.submit".                             |


##### Order Proof Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| proof_type           | string | The proof type which value is "order".                             |
| description      | string | The order description |
| price_currency   | string | The symbol of fiat or digital token, such as USD, RMB, NEW,BTC,ETH.
| total_price      | string | The amount of fiat or digital token, unit is the minimum unit of given fiat or digital token. |
| order_number     | string | The order number |
| order_items      | json | The list of order items, see [schema/order-item.json]. |
| seller           | string | The seller's NewID  |
| customer         | string | The customer's NewID |
| broker           | string | The broker's NewID. optional.  |
| chain_txid           | string | The txid of blockchain. optional.  |

#### Example Parameters
`
{
    "content": {
                ...
        "type": "order",
        "description": "...",
        "total_price": "12.34",
        ...
    },
    "sign_type": "p256",
    "signature": "0x..."
}
`

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| proof_hash           | string | The proof hash                             |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "proof_hash": "...."
}
```

*** 

### proof_getProof
Get the proof information by given proof hash.

#### Path
`
/proofs/:proof_hash/
`

#### Method
`GET`

#### Parameters
none

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| uuid | string | uuid |
| dapp_id           | string | The decentralized application ID                             |
| protocol | string    | protocol name. The default is "HEP".                |
| version | string    | protocol version. The example is "1.0".                |
| ts        | number    | timestamp                                  |
| nonce            | string | random string or auto-increment sequence                              |
| sign_type        | string | Signature Type,aka cryptographic algorithm |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |
| action           | string | The value is "hep.proof.submit".                             |
| expired          | number | Expired timestamp                             |
| description      | string | The order description |
| proof_type       | string | The type of proof information |
| price_currency   | string | symbol of fiat or digital token, such as USD, CNY, NEW,BTC,ETH
| total_price      | string | amount of fiat or digital token, unit is the minimum unit of given fiat or digital token |
| orders | json | orders array |
| order_number     | string | The order number. |
| order_items      | json | The list of order items, see [schema/order-item.json]. |
| seller           | string | The seller's NewID  |
| customer         | string | The customer's NewID |
| broker           | string | The broker's NewID.  |
| chain_txid           | string | The txid of blockchain. optional.  |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "dapp_id":"dappid",
    "protocol":"HEP",
    "version":"1.0",
    "ts":1551222202,
    "nonce":"random string",
    "signature":"secp256r1signature",
    "sign_type":"secp256r1",
    "action":"hep.proof.submit",
    "content":{
        "total_price":"199.33",
        "price_currency":"CNY",
        "submitter":"NEWID182XXXXXXX",
        "proof_type":"order",
        "orders":[
            {
                "order_number":"xxxx",
                "description":"description",
                "chain_txid":"0xtxidxxxxxx",
                "seller":"NEWID18X....",
                "broker":"NEWID182.......",
                "customer": "NEWID182....",
                "total_price": "12",
                "price_currency": "CNY"
                "order_items":[
                    {
                        "order_item_number":"20190505053222",
                        "price":"12.2",
                        "price_currency":"CNY",
                        "ordered_item":{
                            "name":"杯子",
                            "thing_type":"product",
                            "thing_id":"pingguoxxxxxxx"
                        },
                        "order_item_quantity":3
                    }
                ]
            }
        ]
    }
}
```

*** 

### proof_cancelProof

#### Path
`
/proofs/:proof_hash/
`

#### Method
`DELETE`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| dapp_id           | string | The decentralized application ID                             |
| proof_item_id        | string | The proof item id. For order proof, it is order_number. |
| proof_subitem_id        | string | The proof subitem id. For order proof, it is order_item_number. optional. If it is empty, all subitem will be canceled. |
| sign_type        | string | Signature Type,aka cryptographic algorithm. |
| signature        | string | The signature hex string by application owner. The exclude fields is ['dapp_signature_method', 'dapp_signature', 'signature', 'sign_type']. |

#### Example Parameters
TBD

#### Returns
none

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
}
```

***
### proof_getProofReceipts
Get the proof receipts by given proof hashes.

#### Path
`
/proofs/receipts/
`

#### Method
`POST`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| proof_hashes | json | The proof hashes. |

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| receipts | json | The receipts which is proof_hash and proof_status pairs. |


#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "receipts": [
        {
            "proof_hash": "....",
            "proof_status": "....",            
        }
    ]
}
```

***
### proof_getProofRewards
Get the proof reward by given proof data.

#### Path
`
/proofs/rewards/
`

#### Method
`POST`

#### Parameters
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| proof_data | json | The proof data. the format is [{"proof_hash":"...", "proof_item_id":'...', "proof_subitem_id":"..."},] |

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| proof_rewards | json | The proof rewards. |


#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    "proof_rewards": [
        {
            "proof_hash": "....",
            "proof_item_id": "....",
            "proof_subitem_id": "....",
            "earn_tokens": "....",                  
        }
    ]
}
```

## DApp

### dapp_profile

#### Path
`
/dapps/:dapp_id/
`

#### Parameters
none

#### Example Parameters
TBD

#### Returns
| Field            | Type   | Notes                                      |
| ---              | ---    | ---                                        |
| dapp_id           | string | The decentralized application ID                             |
| dapp_name           | string | The decentralized application name                             |
| icon           | string | The icon of application                             |
| dapp_public_key           | string | The public key of DApp                             |
| developer_copyright | string | the dapp copyright |
| package_name | string | The package name such as com.demo.dev.android |
| bundle_id | string | The bundle id such as com.demo.dev.ios for ios platform |
| schema | string | The routing schema |
| website | string | The dapp website link |
| android_download_url | string | The dapp download url |
| ios_download_url | string | the ios download url |
| dweb_download_url | string | the dweb download url |
| newdapp_download_url | string | the newdapp download url |
| deposit_contract_address | string | The deposit contract Address, the example is NEW182.... |
| dapp_type_ids | array[] | The dapp type ids.  support platforms, 1 android, 2 ios, 3 dweb, 4 newdapp |
| dapp_category_id | int | The dapp category id.  |
| auth_login_callback  | string | For Mobile Native DApp, it is redirect schema; For website DApp, it is callback url; For  NewDApp, it is HEP-based url.       |
| pay_order_callback | string | For Mobile Native DApp, it is redirect schema; For website DApp, it is callback url; For  NewDApp, it is HEP-based url. |
| proof_submit_callback | string | For Mobile Native DApp, it is redirect schema; For website DApp, it is callback url; For  NewDApp, it is HEP-based url. |
| android_status | int | the android platform publish status |
| ios_status | int | the ios platform publish status |
| dweb_status | int | the dweb platform publish status |
| newdapp_status | int | the newdapp platform publish status |

#### Example
```
// Request
curl -X POST --data '{}'


// Response
{
    ....    
}
```


### newid

#### Path
`
/newids/:newid/
`

#### Parameters
none

#### Returns
| Field | Type | Notes |
| --- | --- | --- |
| newid | string | The NewID |
| public_key | string | The hex string of NewID's public key |
| main_wallet_address | string | The main wallet address of NewChain |

#### Example
```
// Response
{
    "newid": "NEWID...",
    "public_key": "0x...",
    "main_wallet_address": "NEW182...",
}
```

### NewForce

#### Get the daily statistics of NewForce

##### Path
`
/newforce/:date/
`

* `date` - the date format is '20190808'.


##### Parameters
none

##### Returns
| Field | Type | Notes |
| --- | --- | --- |
| nf_new | string | The conversion rate between NewForce(NF) and NEW |
| nf_cny | string | The conversion rate between NewForce(NF) and CNY |
| nf_usd | string | The conversion rate between NewForce(NF) and USD |
| gnf | string | The global NewForce |


##### Example
```
// Response
{
    "nf_new": "2.6",
    "nf_cny": "2",
    "nf_usd": "2",
    "gnf": "11111111111"
}
```

### Oracle

#### Get the information of given oracle

##### Path
`
/oracles/:oracle_id/
`

* `oracle_id` - The oracle id. The reserved oracle id are as follows: default .

##### Parameters
none

##### Returns
| Field | Type | Notes |
| --- | --- | --- |
| oracle_id | string | The oracle id |
| oracle_name | string | The oracle name |
| public_key | string | The public key of oracle |


##### Example
```
// Response
{
    "oracle_id": "....",
    "oracle_name": "....",
    "public_key": "...."
}
```

### NewChain

#### Get the transaction information of given txid

##### Path
`
/newchain/tx/:txid/
`

##### Parameters
none

##### Returns
| Field | Type | Notes |
| --- | --- | --- |
| txid | string | The transaction ID |
| order_number | string | The order number |
| from_address | string | The from address |
| to_address | string | The to address |
| value | string | The transfer amount |
| block_height | int | The block height |
| status | int | The status of transaction |


##### Example
```
// Response
{
    "txid": "....",
    "order_number": "....",
    "from_address": "....",
    "to_address": "....",
    "value": "....",
    "block_height": 1990000,
    "status":1, 
}
```
